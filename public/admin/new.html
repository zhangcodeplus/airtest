<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>新建文章 - 我的博客</title>
    <link rel="stylesheet" href="/css/main.css" type="text/css" charset="utf-8">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        .editor-container { margin-top: 2rem; }
        .ql-editor { min-height: 300px; }
        .form-group { margin-bottom: 1.5rem; }
        label { font-weight: bold; }
        .btn-primary { background: #007bff; color: #fff; border: none; padding: 0.5rem 1.5rem; border-radius: 4px; cursor: pointer; }
        .btn-primary:hover { background: #0056b3; }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <h1 class="site-title">新建文章</h1>
            <nav>
                <ul>
                    <li><a href="/admin"><i class="fas fa-arrow-left"></i> 返回后台</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        <div class="container">
            <form id="articleForm">
                <div class="form-group">
                    <label for="title">标题</label>
                    <input type="text" id="title" name="title" class="form-control" required style="width:100%;padding:0.5rem;">
                </div>
                <div class="form-group">
                    <label for="category">分类</label>
                    <select id="category" name="category" class="form-control" required style="width:100%;padding:0.5rem;">
                        <option value="">请选择分类</option>
                        <option value="挖矿/手机挖矿">挖矿 / 手机挖矿</option>
                        <option value="挖矿/矿机">挖矿 / 矿机</option>
                        <option value="挖矿/家庭挖矿赚钱品种">挖矿 / 家庭挖矿赚钱品种</option>
                        <option value="挖矿/加密代理">挖矿 / 加密代理</option>
                        <option value="空投推荐/挂机空投">空投推荐 / 挂机空投</option>
                        <option value="空投推荐/交互空投">空投推荐 / 交互空投</option>
                        <option value="空投推荐/游戏空投">空投推荐 / 游戏空投</option>
                        <option value="空投教程/基础装备">空投教程 / 基础装备</option>
                        <option value="空投教程/进阶教程">空投教程 / 进阶教程</option>
                        <option value="交易所推荐/cex推荐">交易所推荐 / CEX推荐</option>
                        <option value="交易所推荐/dex推荐">交易所推荐 / DEX推荐</option>
                        <option value="交易所推荐/质押">交易所推荐 / 质押</option>
                    </select>
                </div>
                <div class="form-group editor-container">
                    <label for="content">内容</label>
                    <div id="editor"></div>
                </div>
                <button type="submit" class="btn-primary">发布文章</button>
            </form>
            <div id="msg" style="margin-top:1rem;"></div>
        </div>
    </main>
    <footer>
        <div class="footer-container">
            <p>Copyright © 2025 我的博客. All rights reserved.</p>
        </div>
    </footer>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slugify/1.6.6/slugify.min.js"></script>
    <script>
        var quill = new Quill('#editor', { theme: 'snow' });
        document.getElementById('articleForm').onsubmit = async function(e) {
            e.preventDefault();
            const title = document.getElementById('title').value.trim();
            const category = document.getElementById('category').value;
            const content = quill.root.innerHTML;
            if (!title || !category || !content || content === '<p><br></p>') {
                document.getElementById('msg').innerHTML = '<span style="color:red;">请填写完整内容</span>';
                return;
            }
            let slug;
            try {
                slug = window.slugify ? window.slugify(title, { lower: true, strict: true }) : title.replace(/\s+/g, '-').toLowerCase();
            } catch (e) {
                slug = title.replace(/\s+/g, '-').toLowerCase();
            }
            document.getElementById('msg').innerHTML = '正在发布...';
            try {
                const res = await fetch('/api/articles', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, slug, content, category, draft: false })
                });
                if (res.ok) {
                    document.getElementById('msg').innerHTML = '<span style="color:green;">发布成功！</span>';
                    document.getElementById('articleForm').reset();
                    quill.setContents([]);
                } else {
                    const errText = await res.text();
                    document.getElementById('msg').innerHTML = '<span style="color:red;">发布失败: ' + errText + '</span>';
                }
            } catch (err) {
                document.getElementById('msg').innerHTML = '<span style="color:red;">网络错误: ' + err + '</span>';
            }
        }
    </script>
</body>
</html> 